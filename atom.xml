<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Ensar Hamzaçebi]]></title>
  <link href="http://ensr.github.io/atom.xml" rel="self"/>
  <link href="http://ensr.github.io/"/>
  <updated>2016-05-11T17:41:27+03:00</updated>
  <id>http://ensr.github.io/</id>
  <author>
    <name><![CDATA[Ensar Hamzaçebi]]></name>
    <email><![CDATA[hamzacebi.ensar@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Android Face Detection 03 - Landmarks Kullanımı]]></title>
    <link href="http://ensr.github.io/blog/2016/02/19/android-face-detection-03-landmarks-kullanimi/"/>
    <updated>2016-02-19T16:28:21+02:00</updated>
    <id>http://ensr.github.io/blog/2016/02/19/android-face-detection-03-landmarks-kullanimi</id>
    <content type="html"><![CDATA[<p><img class="center" src="http://ensr.github.io/images/face_poster.jpg"></p>

<p>Arkadaşlar bu yazımda landmarklardan bahsetmeye çalışıcam biraz. Evet landmarklar en basit haliyle Face API tarafından tespit edilen yüzler üzerindeki özel noktadara verilen isimdir. Yani sol göz, sağ göz, burun ucu, dudak sonu gibi yüzün belirli yerlerini işaret eden noktalardır.</p>

<!-- more -->


<p>Şimdi de landmarkları nasıl kullanıyoruz onu görelim. MainActivity'de <code>onCreate</code> methodumuza bakalım.</p>

<figure class='code'><figcaption><span>MainActivity.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>    <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">InputStream</span> <span class="n">stream</span> <span class="o">=</span> <span class="n">getResources</span><span class="o">().</span><span class="na">openRawResource</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">raw</span><span class="o">.</span><span class="na">image03</span><span class="o">);</span>
</span><span class='line'>    <span class="n">Bitmap</span> <span class="n">bitmap</span> <span class="o">=</span> <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeStream</span><span class="o">(</span><span class="n">stream</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">FaceDetector</span> <span class="n">detector</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FaceDetector</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">())</span>
</span><span class='line'>            <span class="o">.</span><span class="na">setTrackingEnabled</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
</span><span class='line'>            <span class="o">.</span><span class="na">setLandmarkType</span><span class="o">(</span><span class="n">FaceDetector</span><span class="o">.</span><span class="na">ALL_LANDMARKS</span><span class="o">)</span>
</span><span class='line'>            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Frame</span> <span class="n">frame</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Frame</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">setBitmap</span><span class="o">(</span><span class="n">bitmap</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
</span><span class='line'>    <span class="n">SparseArray</span><span class="o">&lt;</span><span class="n">Face</span><span class="o">&gt;</span> <span class="n">faces</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="na">detect</span><span class="o">(</span><span class="n">frame</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">CustomView</span> <span class="n">overlay</span> <span class="o">=</span> <span class="o">(</span><span class="n">CustomView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">customView</span><span class="o">);</span>
</span><span class='line'>    <span class="n">overlay</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="n">bitmap</span><span class="o">,</span> <span class="n">faces</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">detector</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Burada önceki örneklerimizden farklı olarak Face detectorumuzu oluştururken <code>setLandmarkType(FaceDetector.ALL_LANDMARKS)</code> &lsquo;ın eklenmiş olmasıdır.</p>

<p>Bir sonraki adım, daha önceden oluşturduğumuz <code>CustomView</code> sınıfına landmarkları işaretliyecek fonksiyonu eklemek.</p>

<figure class='code'><figcaption><span>CustomView.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kt">void</span> <span class="nf">drawFaceAnnotations</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="o">,</span> <span class="kt">double</span> <span class="n">scale</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Paint</span> <span class="n">paint</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Paint</span><span class="o">();</span>
</span><span class='line'>    <span class="n">paint</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">Color</span><span class="o">.</span><span class="na">GREEN</span><span class="o">);</span>
</span><span class='line'>    <span class="n">paint</span><span class="o">.</span><span class="na">setStyle</span><span class="o">(</span><span class="n">Paint</span><span class="o">.</span><span class="na">Style</span><span class="o">.</span><span class="na">STROKE</span><span class="o">);</span>
</span><span class='line'>    <span class="n">paint</span><span class="o">.</span><span class="na">setStrokeWidth</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">mFaces</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Face</span> <span class="n">face</span> <span class="o">=</span> <span class="n">mFaces</span><span class="o">.</span><span class="na">valueAt</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
</span><span class='line'>        <span class="k">for</span> <span class="o">(</span><span class="n">Landmark</span> <span class="n">landmark</span> <span class="o">:</span> <span class="n">face</span><span class="o">.</span><span class="na">getLandmarks</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>            <span class="kt">int</span> <span class="n">cx</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">landmark</span><span class="o">.</span><span class="na">getPosition</span><span class="o">().</span><span class="na">x</span> <span class="o">*</span> <span class="n">scale</span><span class="o">);</span>
</span><span class='line'>            <span class="kt">int</span> <span class="n">cy</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">landmark</span><span class="o">.</span><span class="na">getPosition</span><span class="o">().</span><span class="na">y</span> <span class="o">*</span> <span class="n">scale</span><span class="o">);</span>
</span><span class='line'>            <span class="n">canvas</span><span class="o">.</span><span class="na">drawCircle</span><span class="o">(</span><span class="n">cx</span><span class="o">,</span> <span class="n">cy</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="n">paint</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Sınıfın tamamını merak edenler konu ile alakalı bir önceki <a href="http://ensr.github.io/blog/2016/02/18/android-face-detection-02/">yazıya</a> bakabilirler.</p>

<p>Fonksiyonu ekledikten sonra <code>onDraw()</code> &lsquo;da <code>drawFaceRectangle()</code> yerine yeni eklediğimiz <code>drawFaceAnnotations()</code> fonksiyonunu çağırmayı unutmuyoruz tabiki.</p>

<figure class='code'><figcaption><span>CustomView.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">drawFaceAnnotations</span><span class="o">(</span><span class="n">canvas</span><span class="o">,</span> <span class="n">scale</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Uygulamamızı bu şekilde çalıştırdığımızda Face Detection'a bitmap olarak verdiğiniz yüz resminde şu şekilde landmarkların işaretlendiğini görebilirsiniz.</p>

<p><img class="center" src="http://ensr.github.io/images/face_landmarks.png"></p>

<p>Şimdilik burada bırakıyorum ancan sonraki yazıda biraz da <code>classification</code> &lsquo;dan bahsedicez. Herhangi bir hata ile karşılaşırsanız yorum yazmayı unutmayın. Kendinize iyi bakın.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android Face Detection 02 - Yüzleri Kara İçine Alma]]></title>
    <link href="http://ensr.github.io/blog/2016/02/18/android-face-detection-02-yuzleri-kara-icine-alma/"/>
    <updated>2016-02-18T17:32:10+02:00</updated>
    <id>http://ensr.github.io/blog/2016/02/18/android-face-detection-02-yuzleri-kara-icine-alma</id>
    <content type="html"><![CDATA[<p><img class="center" src="http://ensr.github.io/images/face_detect_02.jpg"></p>

<p>İlk yazımda google service api ile bitmap üzerinde face detection'ın nasıl gerçekleştirildiğinden bahsetmeye çalışmıştım. Şimdi ise işi biraz daha ilerletip tanımlanan yüz üzerindeki işlemlerden biraz bahsedicem.</p>

<!-- more -->


<h3>Yüzleri Kare İçine Alma</h3>

<p>Tespit edilen yüzleri kare içerisine almak için <code>Viev</code> sınıfından extend edilen <code>CustomView</code> sınıfını oluşturuyoruz.</p>

<figure class='code'><figcaption><span>CustomView.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ensr</span><span class="o">.</span><span class="na">facedetectiondemo</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.content.Context</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.graphics.Bitmap</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.graphics.Canvas</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.graphics.Color</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.graphics.Paint</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.graphics.Rect</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.util.AttributeSet</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.util.SparseArray</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.view.View</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.google.android.gms.vision.face.Face</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomView</span> <span class="kd">extends</span> <span class="n">View</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">Bitmap</span> <span class="n">mBitmap</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">SparseArray</span><span class="o">&lt;</span><span class="n">Face</span><span class="o">&gt;</span> <span class="n">mFaces</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">CustomView</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">AttributeSet</span> <span class="n">attrs</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">attrs</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">void</span> <span class="nf">setContent</span><span class="o">(</span><span class="n">Bitmap</span> <span class="n">bitmap</span><span class="o">,</span> <span class="n">SparseArray</span><span class="o">&lt;</span><span class="n">Face</span><span class="o">&gt;</span> <span class="n">faces</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">mBitmap</span> <span class="o">=</span> <span class="n">bitmap</span><span class="o">;</span>
</span><span class='line'>        <span class="n">mFaces</span> <span class="o">=</span> <span class="n">faces</span><span class="o">;</span>
</span><span class='line'>        <span class="n">invalidate</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onDraw</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onDraw</span><span class="o">(</span><span class="n">canvas</span><span class="o">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">((</span><span class="n">mBitmap</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">mFaces</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>            <span class="kt">double</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">drawBitmap</span><span class="o">(</span><span class="n">canvas</span><span class="o">);</span>
</span><span class='line'>            <span class="n">drawFaceRectangle</span><span class="o">(</span><span class="n">canvas</span><span class="o">,</span> <span class="n">scale</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">double</span> <span class="nf">drawBitmap</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kt">double</span> <span class="n">viewWidth</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="na">getWidth</span><span class="o">();</span>
</span><span class='line'>        <span class="kt">double</span> <span class="n">viewHeight</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="na">getHeight</span><span class="o">();</span>
</span><span class='line'>        <span class="kt">double</span> <span class="n">imageWidth</span> <span class="o">=</span> <span class="n">mBitmap</span><span class="o">.</span><span class="na">getWidth</span><span class="o">();</span>
</span><span class='line'>        <span class="kt">double</span> <span class="n">imageHeight</span> <span class="o">=</span> <span class="n">mBitmap</span><span class="o">.</span><span class="na">getHeight</span><span class="o">();</span>
</span><span class='line'>        <span class="kt">double</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="n">viewWidth</span> <span class="o">/</span> <span class="n">imageWidth</span><span class="o">,</span> <span class="n">viewHeight</span> <span class="o">/</span> <span class="n">imageHeight</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Rect</span> <span class="n">destBounds</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Rect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="o">(</span><span class="kt">int</span><span class="o">)(</span><span class="n">imageWidth</span> <span class="o">*</span> <span class="n">scale</span><span class="o">),</span> <span class="o">(</span><span class="kt">int</span><span class="o">)(</span><span class="n">imageHeight</span> <span class="o">*</span> <span class="n">scale</span><span class="o">));</span>
</span><span class='line'>        <span class="n">canvas</span><span class="o">.</span><span class="na">drawBitmap</span><span class="o">(</span><span class="n">mBitmap</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">destBounds</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">scale</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">drawFaceRectangle</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="o">,</span> <span class="kt">double</span> <span class="n">scale</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Paint</span> <span class="n">paint</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Paint</span><span class="o">();</span>
</span><span class='line'>        <span class="n">paint</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">Color</span><span class="o">.</span><span class="na">GREEN</span><span class="o">);</span>
</span><span class='line'>        <span class="n">paint</span><span class="o">.</span><span class="na">setStyle</span><span class="o">(</span><span class="n">Paint</span><span class="o">.</span><span class="na">Style</span><span class="o">.</span><span class="na">STROKE</span><span class="o">);</span>
</span><span class='line'>        <span class="n">paint</span><span class="o">.</span><span class="na">setStrokeWidth</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">mFaces</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">Face</span> <span class="n">face</span> <span class="o">=</span> <span class="n">mFaces</span><span class="o">.</span><span class="na">valueAt</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
</span><span class='line'>            <span class="n">canvas</span><span class="o">.</span><span class="na">drawRect</span><span class="o">((</span><span class="kt">float</span><span class="o">)(</span><span class="n">face</span><span class="o">.</span><span class="na">getPosition</span><span class="o">().</span><span class="na">x</span> <span class="o">*</span> <span class="n">scale</span><span class="o">),</span>
</span><span class='line'>                <span class="o">(</span><span class="kt">float</span><span class="o">)(</span><span class="n">face</span><span class="o">.</span><span class="na">getPosition</span><span class="o">().</span><span class="na">y</span> <span class="o">*</span> <span class="n">scale</span><span class="o">),</span>
</span><span class='line'>                <span class="o">(</span><span class="kt">float</span><span class="o">)((</span><span class="n">face</span><span class="o">.</span><span class="na">getPosition</span><span class="o">().</span><span class="na">x</span> <span class="o">+</span> <span class="n">face</span><span class="o">.</span><span class="na">getWidth</span><span class="o">())</span> <span class="o">*</span> <span class="n">scale</span><span class="o">),</span>
</span><span class='line'>                <span class="o">(</span><span class="kt">float</span><span class="o">)((</span><span class="n">face</span><span class="o">.</span><span class="na">getPosition</span><span class="o">().</span><span class="na">y</span> <span class="o">+</span> <span class="n">face</span><span class="o">.</span><span class="na">getHeight</span><span class="o">())</span> <span class="o">*</span> <span class="n">scale</span><span class="o">),</span>
</span><span class='line'>                <span class="n">paint</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Yukarıdaki kodda <code>onDraw</code> methodunu override ediyoruz ve tespit edilen yüzleri kare içerisine alması için <code>drawFaceRectangle</code> fonksitonunu çağırıyoruz.</p>

<p>Daha sonra activity_main.xml'imi şu şekilde değiştiriyoruz.</p>

<figure class='code'><figcaption><span>activity_main.xml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;RelativeLayout</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
</span><span class='line'>            <span class="na">xmlns:tools=</span><span class="s">&quot;http://schemas.android.com/tools&quot;</span>
</span><span class='line'>            <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>            <span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>            <span class="na">tools:context=</span><span class="s">&quot;.MainActivity&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;com.ensr.facedetectiondemo.CustomView</span>
</span><span class='line'>        <span class="na">android:id=</span><span class="s">&quot;@+id/customView&quot;</span>
</span><span class='line'>        <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>        <span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;/RelativeLayout&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>MainActivity'de daha önceki yazımda oluşturduğumuz <code>TextView</code>&lsquo;ı kaldırıp şu şekilde güncelliyoruz.</p>

<figure class='code'><figcaption><span>MainActivity.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>    <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">InputStream</span> <span class="n">stream</span> <span class="o">=</span> <span class="n">getResources</span><span class="o">().</span><span class="na">openRawResource</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">raw</span><span class="o">.</span><span class="na">image01</span><span class="o">);</span>
</span><span class='line'>    <span class="n">Bitmap</span> <span class="n">bitmap</span> <span class="o">=</span> <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeStream</span><span class="o">(</span><span class="n">stream</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">FaceDetector</span> <span class="n">detector</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FaceDetector</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">())</span>
</span><span class='line'>            <span class="o">.</span><span class="na">setTrackingEnabled</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
</span><span class='line'>            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Frame</span> <span class="n">frame</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Frame</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">setBitmap</span><span class="o">(</span><span class="n">bitmap</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
</span><span class='line'>    <span class="n">SparseArray</span><span class="o">&lt;</span><span class="n">Face</span><span class="o">&gt;</span> <span class="n">faces</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="na">detect</span><span class="o">(</span><span class="n">frame</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// CustonView i oluştur, bitmap ve tespit edilen yüzlerin listesini ver</span>
</span><span class='line'>    <span class="n">CustomView</span> <span class="n">overlay</span> <span class="o">=</span> <span class="o">(</span><span class="n">CustomView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">customView</span><span class="o">);</span>
</span><span class='line'>    <span class="n">overlay</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="n">bitmap</span><span class="o">,</span> <span class="n">faces</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">detector</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Evet bu uygulamayı bu haliyle çalıştırdığımızda ekran görüntünüz şunun gibi bişey olacaktır.</p>

<p><img class="center" src="http://ensr.github.io/images/face_detect_03.png"></p>

<p>Şimdilik bu kadar bir sonraki yazımda göz burun ve ağız gibi yüzün bazı bölgelerinin yerlerinin tespit edilmesinden bahsetmeye çalışıcam. Umarım yazımı faydalı bulmuşsunuzdur. Kafanıza takılan bişey olursa yorum yazmaktan çekinmeyin.</p>

<p>İyi günler.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android Face Detection 01 - Başlangıç]]></title>
    <link href="http://ensr.github.io/blog/2016/02/18/android-face-detection-01/"/>
    <updated>2016-02-18T15:45:52+02:00</updated>
    <id>http://ensr.github.io/blog/2016/02/18/android-face-detection-01</id>
    <content type="html"><![CDATA[<p><img class="center" src="http://ensr.github.io/images/face_detect.png"></p>

<p>Android'de face detection işlemini gerçekleştirmek için Google Play Service'i kullanabiliriz.Bunun için yapmamız gereken ilk şey google play service'in gradle dependences'ini projemize eklemek olacaktır.</p>

<p>Android Studio'da oluşturduğumuz projemizin /app dizini altındaki build.gradle dosyasını açarak dependencies kısmına aşşağıdaki satırı ekliyoruz ve Sync ediyoruz.</p>

<!-- more -->




<figure class='code'><figcaption><span>build.gradle</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>compile &#39;com.google.android.gms:play-services:7.8.0&#39;
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Bir sonraki adımımız AndroidManifest.xml dosyasına aşağıda verdiğimiz meta-data'yı application tag'inin içerisine eklemek.</p>

<figure class='code'><figcaption><span>AndroidManifest.xml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;meta-data</span> <span class="na">android:name=</span><span class="s">&quot;com.google.android.gms.vision.DEPENDENCIES&quot;</span> <span class="na">android:value=</span><span class="s">&quot;face&quot;</span><span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Daha sonra yüz tesbiti yapacağımız resimi /res/raw dizinine koyuyoruz. MainActivity.java'yı (Main activity) açarak aşağıdaki kodu onCreate'in içerisine yazıyoruz.</p>

<figure class='code'><figcaption><span>MainActivity.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>    <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Resimi bitmap formatına döndürüyoruz.</span>
</span><span class='line'>    <span class="n">InputStream</span> <span class="n">stream</span> <span class="o">=</span> <span class="n">getResources</span><span class="o">().</span><span class="na">openRawResource</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">raw</span><span class="o">.</span><span class="na">image01</span><span class="o">);</span>
</span><span class='line'>    <span class="n">Bitmap</span> <span class="n">bitmap</span> <span class="o">=</span> <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeStream</span><span class="o">(</span><span class="n">stream</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Face Detector&#39;ü burada oluşturuyoruz.</span>
</span><span class='line'>    <span class="n">FaceDetector</span> <span class="n">detector</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FaceDetector</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">())</span>
</span><span class='line'>            <span class="o">.</span><span class="na">setTrackingEnabled</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
</span><span class='line'>            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Bitmap&#39;imiz üzerinde face detection&#39;un çalışması için bir frame oluşturuyoruz.</span>
</span><span class='line'>    <span class="n">Frame</span> <span class="n">frame</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Frame</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">setBitmap</span><span class="o">(</span><span class="n">bitmap</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Face detector&#39;ü çalıştırarak resimde belirlenen yüzleri SparseArray&#39;e listeliyoruz.</span>
</span><span class='line'>    <span class="n">SparseArray</span><span class="o">&lt;</span><span class="n">Face</span><span class="o">&gt;</span> <span class="n">faces</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="na">detect</span><span class="o">(</span><span class="n">frame</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//Ekrana resimde kaç yüz tespit edildiğini gösteriyoruz.</span>
</span><span class='line'>    <span class="n">TextView</span> <span class="n">faceCountView</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">face_count</span><span class="o">);</span>
</span><span class='line'>    <span class="n">faceCountView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">faces</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; faces detected&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//face detection&#39;u sonlandırıyoruz.</span>
</span><span class='line'>    <span class="n">detector</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Evet arkadaşlar, bu şekilde bir resimde yüz olup olmadığını varsa kaç tane olduklarını tespit edebilirsiniz. Şunu da söylemem gerek google'ın bu servisi sadece yüz tespit etmeye yarar, yüz tanıma gibi bir özelliği bulunmamaktadır.</p>

<p>Umarım yardımcı olabilmişimdir. İyi çalışmalar.</p>
]]></content>
  </entry>
  
</feed>
